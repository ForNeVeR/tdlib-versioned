# SPDX-FileCopyrightText: 2025 Friedrich von Never <friedrich@fornever.me>
#
# SPDX-License-Identifier: BSL-1.0

# This file is auto-generated.
name: Release
on:
  push:
    branches:
    - main
  pull_request:
    branches:
    - main
  schedule:
  - cron: 0 0 * * *
  workflow_dispatch: 
jobs:
  release:
    permissions:
      contents: write
    runs-on: ubuntu-24.04
    steps:
    - name: Check out the sources
      uses: actions/checkout@v6
    - name: Set up .NET SDK
      uses: actions/setup-dotnet@v5
    - id: extract-release
      name: Extract release information
      shell: pwsh
      run: dotnet fsi ./scripts/extract-release.fsx
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    - if: (github.event_name == 'schedule' || github.event_name == 'workflow_dispatch') && steps.extract-release.outputs.has-changes == 'true'
      name: Prepare a release
      uses: softprops/action-gh-release@v2
      with:
        body: ${{ steps.extract-release.outputs.body }}
        draft: ${{ steps.extract-release.outputs.draft }}
        make_latest: ${{ steps.extract-release.outputs.make-latest }}
        name: ${{ steps.extract-release.outputs.name }}
        tag_name: ${{ steps.extract-release.outputs.tag-name }}
        target_commitish: ${{ steps.extract-release.outputs.commit }}
